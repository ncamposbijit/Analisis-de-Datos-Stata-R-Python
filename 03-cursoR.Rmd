# Data Analysis with R

## Introduction to R and RStudio

### Why use R as a programming language?

-  **Open source:** The license is free.

-  **Versatile:** statistical and econometric analysis + useful programming tasks (e.g., web scraping).

-  **Flexible and reproducible:** ensures reproducibility, is flexible to changes and error detection. 
    
-  **In demand:** Open-source programming languages are increasingly requested in the labor market.


### Key and recurring terms throughout the course

-   **RStudio:** Graphical User Interface. It is designed to make using R easier.
-   **Objects:** Anything you store in R. For example: datasets, variables, lists of names, plots.
-   **Functions:** An operation produced by code that accepts inputs and returns outputs.
-   **Packages:** A set of functions grouped according to their purpose. 
-   **Scripts/Code:** Document that contains all commands used in a data analysis process.


### Learning Resources

::: {style="text-align: justify"}
-   Cheat sheets: material available with a summary of the main commands/packages/functions for different topics.
    Available at: <https://www.rstudio.com/resources/cheatsheets/>
:::

-   Forums and websites:
    -   [Stackoverflow](https://stackoverflow.com/questions/tagged/r)
    -   [Medium](https://preettheman.medium.com/awesome-tricks-every-r-coder-should-know-c4220cd2cfbc)
    -   [The RStudio Blog](https://posit.co/)
-   Books:
    -   [R for Data Science](https://r4ds.had.co.nz/)
    -   [Resources about R in Spanish.](https://posit.co/resources/videos/)
    -   [Bookdown](https://bookdown.org/)
- 


### RStudio Interface
  #### Four sections in RStudio

The fundamental ones are: *Scripts, Console, 
Environment/Files/Help*.

- **Scripts:** Where we will develop the code. It is a notebook. 
- **Console:** Where we will see the results.
- **Environment:** Where we will see the data and the information we are generating.
- **Files:** Where we will see the files associated with our projects.
- **Help:** Where we will develop the code. It is a notebook. 

To customize RStudio go to: **Tools -> Global Options**.
There you can change the environment color, font type, layout order. The
idea is to use RStudio in the most intuitive way possible. 
  
  #### Writing comments

It is very important to write comments throughout your code. It is also important to know how to write **good** comments. A very good guide that discusses this and many other things is: [Code and Data for the Social Sciences: A Practitioner's Guide](https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf).

`(#)` to write comments in the script. If I want to mark multiple
lines as comments: `ctrl + shift + c`

  #### Indices

It is important to write indices to document your code. To
see it I must type: `ctrl + shift + o`

Titles can be hierarchical:

```{r message=FALSE}
# The most important
## This is a bit less important
### This is a bit less important than the previous one
#### The least important
```

It is important to update it constantly to avoid losing functionality.


### Package installation and help

Packages are basically collections of functions. Packages are installed once, but they are called every time they are used.

#### Libraries

This can be done in two ways:

1.  From the *Packages* tab in the bottom-right corner.

2.  Using commands


```{r message = FALSE, warning = FALSE, results="hide"}
install.packages("dplyr")
```

Many packages at the same time: 

```{r, eval=FALSE}
install.packages(c("dplyr","ggplot2","rio"))
```

Common error: 
```{r, eval=FALSE}
install.packages("dplyr", "ggplot2")
```

In general, it is a good idea to install them at the beginning of your work, since we commonly use the same libraries when doing data analysis. With this function, we tell R to install the package if it is not installed (something typical when we switch computers):

```{r, eval=FALSE}
if(!require(dplyr)) {install.packages("dplyr")}
```

Load libraries: 

```{r, eval=FALSE}
library(dplyr)
```

If we want to see what is inside each package:

```{r, eval=FALSE}
ls("package:dplyr", all = TRUE) #ls = list objects
```

**Important**: the package must be installed once, but loaded every time it is used. There are often updates. To check and install them:


```{r, eval=FALSE}
update.packages()
```

Alternatively, I can link a package to a function using `::`. If I do this, it is not necessary to load the library in order to use that specific function. However, the recommended practice is to load all the libraries of the packages I will use at the beginning.

#### Help function 

About a specific function: 

```{r, eval=FALSE}
help(mean) 
?mean 
mean 
sd
```

About a specific package: 

```{r, eval=FALSE}
help("dplyr") 
library(help="dplyr")
```

#### Useful *Shortcuts*

-   `Esc`: interrupt the current command
-   `Ctrl + s`: save
-   `tab`: autocomplete
-   `Ctrl + Enter`: run line
-   `Ctrl + Shift + C`: comment/uncomment
-   `<-`: Alt + - / option + -
-   `%>%`: Ctrl + Shift + M (*pipe*)
-   `Ctrl + l`: clear console
-   `Ctrl + Alt + b`: run everything up to here (the arrow keys in the console allow you to view the most recent commands used)
-   `Shift + lines`: select multiple lines
-   `Ctrl + f`: find/replace
-   `Ctrl + Up Arrow` (in the console): view previously used commands


#### Clear the R *environment*

Remove all objects:

```{r}
rm(list=ls())
```

Remove only one object 

```{r}
rm(data1)
```

If I want to clear the console, I need to press `Ctrl + L`.

#### Identify the package of a function

Sometimes we want to know which package a given function belongs to. For that, check:
<https://sebastiansauer.github.io/finds_funs/>
`

Note that a `+` sign appears in the console. In these cases, RStudio stops because you probably forgot a `)` or a `#`. You must correct the error, run the code again, and then press `Esc` in the console to continue executing commands.


### R Markdown

- A tool for creating reports that are automatic, reproducible, and based on data that can be updated over time.
- Reports can be generated in Word, PDF, or HTML format.
- R Markdown (`.Rmd`) is basically an intersection between narrative text and code that generates visualizations and estimations in order to analyze data.
- `.Rmd` can generate: plain text, code chunks, plots, tables, and interactive dashboards.
- R Markdown is especially useful for:
  - **Routine reports:** For example, a weekly report for a set of analyses that is updated over time.
  - **Analytical reports for subsets of data:** For example, country-specific reports from a dataset that contains information for multiple countries.

#### Basic concepts

- **Markdown** is the language that allows you to write documents in plain text. Files written in Markdown have the `.md` extension.
- **R Markdown** is the R-specific variation. It allows you to write plain text using Markdown and embed R code. Files written in R Markdown have the `.Rmd` extension.
- **knitr:** An R package. It is used to read (and execute) the code chunks that we include in reports.
- **Pandoc:** Used to convert the output into a Word/PDF/HTML formatted file. It is software that is installed automatically with RStudio.

#### Process

![Source: https://rmarkdown.rstudio.com/authoring/quick_tour.html](01figuras/C8.1.png)

#### First R Markdown file

![](01figuras/C8.2.png)  
![](01figuras/C8.3.png)

- Options to choose the type of document and whether you want to create a document, a presentation, a dashboard, or other more specialized formats.
- Options to change the title and the author.

#### Working directory

- The working directory of a `.Rmd` file is the folder where the file is saved.
- Therefore, R will search for files in the same folder where the `.Rmd` file is stored.
- For this exercise, we will simply keep the data we use in the same folder as the `.Rmd` file.

#### Components of R Markdown

![](01figuras/C8.4.png)

- YAML: set title, date, and output type.
- Markdown text: write narrative text.
- Code chunk: load packages, data, and create visualizations.

![](01figuras/C8.5.png)


